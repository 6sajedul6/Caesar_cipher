Tried to modify the code and fixed some bugs.
